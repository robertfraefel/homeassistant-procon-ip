##############################################################################
#  ProCon.IP Pool Controller â€“ Home Assistant Lovelace Dashboard
#
#  HOW TO IMPORT
#  -------------
#  1.  Open Home Assistant â†’ Settings â†’ Dashboards â†’ Add dashboard
#  2.  Choose "YAML dashboard" and give it a title (e.g. "Pool")
#  3.  Paste the contents of this file into the "YAML configuration" field.
#      Alternatively: save it to  <config>/dashboards/pool_dashboard.yaml
#      and reference it in configuration.yaml:
#
#          lovelace:
#            dashboards:
#              pool-dashboard:
#                mode: yaml
#                filename: dashboards/pool_dashboard.yaml
#                title: Pool
#                icon: mdi:pool
#
#  HOW TO ADAPT ENTITY IDs
#  -----------------------
#  Home Assistant builds entity IDs from the device name and the CSV label
#  on the ProCon.IP.  By default the device name is "ProCon.IP Pool Controller"
#  which slugifies to "procon_ip_pool_controller".
#
#  If you renamed the device (or the CSV labels differ from the defaults)
#  do a global find-and-replace on the slug below with your actual slug.
#
#  Default slug:  procon_ip_pool_controller
#
#  Examples of entity IDs used in this dashboard:
#    sensor.procon_ip_pool_controller_pool           â† Pool water temperature
#    sensor.procon_ip_pool_controller_ph             â† pH value
#    sensor.procon_ip_pool_controller_redox          â† Redox (ORP) value
#    sensor.procon_ip_pool_controller_durchfluss     â† Flow sensor
#    sensor.procon_ip_pool_controller_kesseldruck    â† Filter pressure
#    sensor.procon_ip_pool_controller_absorber       â† Solar absorber temp
#    sensor.procon_ip_pool_controller_rucklauf       â† Return line temp
#    sensor.procon_ip_pool_controller_aussen         â† Outdoor temperature
#    sensor.procon_ip_pool_controller_cl_rest        â† Chlorine canister level
#    sensor.procon_ip_pool_controller_ph_rest        â† pH- canister level
#    sensor.procon_ip_pool_controller_ph_rest_1      â† pH+ canister level
#    sensor.procon_ip_pool_controller_cl_consumption â† Chlorine used (mL)
#    sensor.procon_ip_pool_controller_ph_consumption â† pH- used (mL)
#    sensor.procon_ip_pool_controller_ph_consumption_1 â† pH+ used (mL)
#    select.procon_ip_pool_controller_filterpumpe_n1 â† Filter pump relay
#    select.procon_ip_pool_controller_cl_pumpe       â† Chlorine dosing pump
#    select.procon_ip_pool_controller_ph_pumpe       â† pH dosing pump
#    binary_sensor.procon_ip_pool_controller_poolabdeckung â† Pool cover
##############################################################################

title: Pool
views:

  ##########################################################################
  #  VIEW 1 â€“ OVERVIEW
  ##########################################################################
  - title: Overview
    path: pool-overview
    icon: mdi:pool
    cards:

      # â”€â”€ Header banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: markdown
        content: >
          # ðŸŠ Pool Dashboard
          **ProCon.IP Pool Controller** â€“ live data updated every 30 s

      # â”€â”€ Quick-glance row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: glance
        title: Current Status
        show_state: true
        show_name: true
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Water Temp
            icon: mdi:thermometer-water
          - entity: sensor.procon_ip_pool_controller_ph
            name: pH
            icon: mdi:ph
          - entity: sensor.procon_ip_pool_controller_redox
            name: Redox
            icon: mdi:flash
          - entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow
            icon: mdi:water-pump
          - entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Pressure
            icon: mdi:gauge
          - entity: binary_sensor.procon_ip_pool_controller_poolabdeckung
            name: Pool Cover
            icon: mdi:shield-sun

      # â”€â”€ Water quality gauges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: horizontal-stack
        cards:

          # Pool water temperature
          - type: gauge
            entity: sensor.procon_ip_pool_controller_pool
            name: Water Temperature
            unit: Â°C
            min: 10
            max: 35
            needle: true
            severity:
              green: 24   # comfortable swimming range
              yellow: 30  # getting warm
              red: 33     # too hot

          # pH gauge  â€“  ideal range 7.2 â€“ 7.4
          - type: gauge
            entity: sensor.procon_ip_pool_controller_ph
            name: pH Value
            unit: pH
            min: 6.5
            max: 8.0
            needle: true
            severity:
              red: 6.5     # too acidic
              yellow: 7.0  # acceptable lower bound
              green: 7.2   # ideal start
              # green up to 7.4 is fine; HA gauge only supports 3 bands

          # Redox / ORP gauge  â€“  ideal â‰¥ 650 mV for good disinfection
          - type: gauge
            entity: sensor.procon_ip_pool_controller_redox
            name: Redox (ORP)
            unit: mV
            min: 400
            max: 900
            needle: true
            severity:
              red: 400     # very poor disinfection
              yellow: 600  # borderline
              green: 650   # adequate disinfection

      # â”€â”€ Temperature overview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: Temperatures
        icon: mdi:thermometer
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Pool water
            icon: mdi:pool-thermometer
          - entity: sensor.procon_ip_pool_controller_absorber
            name: Solar absorber
            icon: mdi:solar-panel
          - entity: sensor.procon_ip_pool_controller_rucklauf
            name: Return line
            icon: mdi:pipe
          - entity: sensor.procon_ip_pool_controller_aussen
            name: Outdoor
            icon: mdi:weather-sunny

      # â”€â”€ Pump & relay controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: Equipment Control
        icon: mdi:electric-switch
        entities:
          - type: section
            label: Pumps
          - entity: select.procon_ip_pool_controller_filterpumpe_n1
            name: Filter Pump
            icon: mdi:pump
          - entity: select.procon_ip_pool_controller_cl_pumpe
            name: Chlorine Dosing Pump
            icon: mdi:water-plus
          - entity: select.procon_ip_pool_controller_ph_pumpe
            name: pH Dosing Pump
            icon: mdi:water-minus
          - type: section
            label: Other Relays
          - entity: select.procon_ip_pool_controller_beleuchtung
            name: Pool Lighting
            icon: mdi:lightbulb
          - entity: select.procon_ip_pool_controller_heizung
            name: Heating
            icon: mdi:radiator

      # â”€â”€ Canister fill levels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: horizontal-stack
        cards:

          - type: vertical-stack
            cards:
              - type: markdown
                content: "### Canister Levels"
              - type: gauge
                entity: sensor.procon_ip_pool_controller_cl_rest
                name: Chlorine
                unit: "%"
                min: 0
                max: 100
                needle: false
                severity:
                  red: 0
                  yellow: 20
                  green: 40
              - type: gauge
                entity: sensor.procon_ip_pool_controller_ph_rest
                name: pHâˆ’
                unit: "%"
                min: 0
                max: 100
                needle: false
                severity:
                  red: 0
                  yellow: 20
                  green: 40
              - type: gauge
                entity: sensor.procon_ip_pool_controller_ph_rest_1
                name: pH+
                unit: "%"
                min: 0
                max: 100
                needle: false
                severity:
                  red: 0
                  yellow: 20
                  green: 40

          - type: vertical-stack
            cards:
              - type: markdown
                content: "### Chemical Consumption"
              - type: entities
                entities:
                  - entity: sensor.procon_ip_pool_controller_cl_consumption
                    name: Chlorine used
                    icon: mdi:flask
                  - entity: sensor.procon_ip_pool_controller_ph_consumption
                    name: pHâˆ’ used
                    icon: mdi:flask-outline
                  - entity: sensor.procon_ip_pool_controller_ph_consumption_1
                    name: pH+ used
                    icon: mdi:flask-empty-outline

      # â”€â”€ Digital inputs (binary sensors) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: Digital Inputs
        icon: mdi:electric-switch-closed
        entities:
          - entity: binary_sensor.procon_ip_pool_controller_poolabdeckung
            name: Pool Cover
            icon: mdi:shield-sun
          - entity: binary_sensor.procon_ip_pool_controller_taster2
            name: Button 2
            icon: mdi:gesture-tap-button
          - entity: binary_sensor.procon_ip_pool_controller_taster3
            name: Button 3
            icon: mdi:gesture-tap-button

      # â”€â”€ Diagnostics row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: horizontal-stack
        cards:
          - type: entity
            entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Filter Pressure
            icon: mdi:gauge
          - type: entity
            entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow Rate
            icon: mdi:water-pump


  ##########################################################################
  #  VIEW 2 â€“ HISTORY / CHARTS
  ##########################################################################
  - title: History
    path: pool-history
    icon: mdi:chart-line
    cards:

      - type: markdown
        content: "## Historical Trends"

      # Temperature history â€“ 48 h
      - type: history-graph
        title: Temperatures (48 h)
        hours_to_show: 48
        refresh_interval: 60
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Pool water
          - entity: sensor.procon_ip_pool_controller_absorber
            name: Absorber
          - entity: sensor.procon_ip_pool_controller_rucklauf
            name: Return line
          - entity: sensor.procon_ip_pool_controller_aussen
            name: Outdoor

      # pH history â€“ 7 days
      - type: history-graph
        title: pH (7 days)
        hours_to_show: 168
        refresh_interval: 300
        entities:
          - entity: sensor.procon_ip_pool_controller_ph
            name: pH

      # Redox history â€“ 7 days
      - type: history-graph
        title: Redox / ORP (7 days)
        hours_to_show: 168
        refresh_interval: 300
        entities:
          - entity: sensor.procon_ip_pool_controller_redox
            name: Redox

      # Flow rate & pressure â€“ 48 h
      - type: history-graph
        title: Flow & Pressure (48 h)
        hours_to_show: 48
        refresh_interval: 60
        entities:
          - entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow (L/h)
          - entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Pressure (bar)

      # Canister levels â€“ 30 days
      - type: history-graph
        title: Canister Fill Levels (30 days)
        hours_to_show: 720
        refresh_interval: 3600
        entities:
          - entity: sensor.procon_ip_pool_controller_cl_rest
            name: Chlorine %
          - entity: sensor.procon_ip_pool_controller_ph_rest
            name: pHâˆ’ %
          - entity: sensor.procon_ip_pool_controller_ph_rest_1
            name: pH+ %


  ##########################################################################
  #  VIEW 3 â€“ RELAY CONTROL
  ##########################################################################
  - title: Controls
    path: pool-controls
    icon: mdi:toggle-switch
    cards:

      - type: markdown
        content: >
          ## Relay Control

          Each relay supports three modes:
          - **auto** â€“ the ProCon.IP schedule / dosage logic controls this relay
          - **on**   â€“ force the relay permanently on (manual override)
          - **off**  â€“ force the relay permanently off (manual override)

          > Always return relays to **auto** after manual testing so the device
          > can resume its programmed schedule.

      # Internal relays
      - type: entities
        title: Internal Relays (N1â€“N8)
        icon: mdi:electric-switch
        entities:
          - entity: select.procon_ip_pool_controller_filterpumpe_n1
            name: Filter Pump (N1)
            icon: mdi:pump
          - entity: select.procon_ip_pool_controller_n2
            name: Relay N2
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n3
            name: Relay N3
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n4
            name: Relay N4
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n5
            name: Relay N5
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n6
            name: Relay N6
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n7
            name: Relay N7
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_n8
            name: Relay N8
            icon: mdi:electric-switch

      # External relays
      - type: entities
        title: External Relays (E1â€“E8)
        icon: mdi:electric-switch-closed
        entities:
          - entity: select.procon_ip_pool_controller_e1
            name: External Relay E1
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e2
            name: External Relay E2
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e3
            name: External Relay E3
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e4
            name: External Relay E4
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e5
            name: External Relay E5
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e6
            name: External Relay E6
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e7
            name: External Relay E7
            icon: mdi:electric-switch
          - entity: select.procon_ip_pool_controller_e8
            name: External Relay E8
            icon: mdi:electric-switch

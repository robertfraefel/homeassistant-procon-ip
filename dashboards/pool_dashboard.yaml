##############################################################################
#  ProCon.IP Pool Controller – Home Assistant Lovelace Dashboard
#
#  HOW TO ADAPT ENTITY IDs
#  -----------------------
#  Home Assistant builds entity IDs from the device name and the CSV label
#  on the ProCon.IP.  By default the device name is "ProCon.IP Pool Controller"
#  which slugifies to "procon_ip_pool_controller".
#
#  If you renamed the device (or the CSV labels differ from the defaults)
#  do a global find-and-replace on the slug below with your actual slug.
#
#  Default slug:  procon_ip_pool_controller
##############################################################################

title: Pool
views:

  ##########################################################################
  #  VIEW 1 – OVERVIEW
  ##########################################################################
  - title: Overview
    path: pool-overview
    icon: mdi:pool
    cards:

      # ── Water quality gauges ─────────────────────────────────────────────
      - type: horizontal-stack
        cards:

          - type: custom:apexcharts-card
            chart_type: radialBar
            header:
              show: true
              title: Water Temperature
              show_states: true
              colorize_states: true
            series:
              - entity: sensor.procon_ip_pool_controller_pool
                min: 10
                max: 40
                color_threshold:
                  - value: 10
                    color: "#4caf50"
                  - value: 28
                    color: "#ffc107"
                  - value: 34
                    color: "#f44336"

          - type: custom:apexcharts-card
            chart_type: radialBar
            header:
              show: true
              title: pH Value
              show_states: true
              colorize_states: true
            series:
              - entity: sensor.procon_ip_pool_controller_ph
                min: 6.5
                max: 8.0
                color_threshold:
                  - value: 6.5
                    color: "#f44336"
                  - value: 7.0
                    color: "#4caf50"
                  - value: 7.4
                    color: "#ffc107"
                  - value: 8.0
                    color: "#f44336"

          - type: custom:apexcharts-card
            chart_type: radialBar
            header:
              show: true
              title: Redox (ORP)
              show_states: true
              colorize_states: true
            series:
              - entity: sensor.procon_ip_pool_controller_redox
                min: 0
                max: 900
                color_threshold:
                  - value: 0
                    color: "#f44336"
                  - value: 650
                    color: "#ffc107"
                  - value: 750
                    color: "#4caf50"

      # ── Quick-glance status ───────────────────────────────────────────────
      - type: glance
        title: Current Status
        show_state: true
        show_name: true
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Water Temp
            icon: mdi:thermometer-water
          - entity: sensor.procon_ip_pool_controller_ph
            name: pH
            icon: mdi:ph
          - entity: sensor.procon_ip_pool_controller_redox
            name: Redox
            icon: mdi:flash
          - entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow
            icon: mdi:water-pump
          - entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Pressure
            icon: mdi:gauge

      # ── Temperature overview ─────────────────────────────────────────────
      - type: entities
        title: Temperatures
        icon: mdi:thermometer
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Pool water
            icon: mdi:pool-thermometer
          - entity: sensor.procon_ip_pool_controller_absorber
            name: Solar absorber
            icon: mdi:solar-panel
          - entity: sensor.procon_ip_pool_controller_rucklauf
            name: Return line
            icon: mdi:pipe
          - entity: sensor.procon_ip_pool_controller_aussen
            name: Outdoor
            icon: mdi:weather-sunny

      # ── Filter pump & diagnostics ────────────────────────────────────────
      - type: entities
        title: Filter Pump
        icon: mdi:pump
        entities:
          - entity: select.procon_ip_pool_controller_filterpumpe_n1
            name: Filter Pump (N1)
            icon: mdi:pump
          - entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Filter Pressure
            icon: mdi:gauge
          - entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow Rate
            icon: mdi:water-pump

      # ── Canister fill levels ─────────────────────────────────────────────
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.procon_ip_pool_controller_cl_rest
            name: Chlorine
            unit: "%"
            min: 0
            max: 100
            needle: false
            severity:
              red: 0
              yellow: 20
              green: 40
          - type: gauge
            entity: sensor.procon_ip_pool_controller_ph_rest
            name: pH−
            unit: "%"
            min: 0
            max: 100
            needle: false
            severity:
              red: 0
              yellow: 20
              green: 40

      # ── Chemical consumption ─────────────────────────────────────────────
      - type: entities
        title: Chemical Consumption
        icon: mdi:flask
        entities:
          - entity: sensor.procon_ip_pool_controller_cl_consumption
            name: Chlorine used
            icon: mdi:flask
          - entity: sensor.procon_ip_pool_controller_ph_consumption
            name: pH− used
            icon: mdi:flask-outline

      # ── Digital inputs ────────────────────────────────────────────────────
      - type: entities
        title: Digital Inputs
        icon: mdi:electric-switch-closed
        entities:
          - entity: binary_sensor.procon_ip_pool_controller_poolabdeckung
            name: Pool Cover
            icon: mdi:shield-sun
          - entity: binary_sensor.procon_ip_pool_controller_taster2
            name: Button 2
            icon: mdi:gesture-tap-button
          - entity: binary_sensor.procon_ip_pool_controller_taster3
            name: Button 3
            icon: mdi:gesture-tap-button


  ##########################################################################
  #  VIEW 2 – HISTORY / CHARTS
  ##########################################################################
  - title: History
    path: pool-history
    icon: mdi:chart-line
    cards:

      - type: history-graph
        title: Temperatures (48 h)
        hours_to_show: 48
        refresh_interval: 60
        entities:
          - entity: sensor.procon_ip_pool_controller_pool
            name: Pool water
          - entity: sensor.procon_ip_pool_controller_absorber
            name: Absorber
          - entity: sensor.procon_ip_pool_controller_rucklauf
            name: Return line
          - entity: sensor.procon_ip_pool_controller_aussen
            name: Outdoor

      - type: history-graph
        title: pH (7 days)
        hours_to_show: 168
        refresh_interval: 300
        entities:
          - entity: sensor.procon_ip_pool_controller_ph
            name: pH

      - type: history-graph
        title: Redox / ORP (7 days)
        hours_to_show: 168
        refresh_interval: 300
        entities:
          - entity: sensor.procon_ip_pool_controller_redox
            name: Redox

      - type: history-graph
        title: Flow & Pressure (48 h)
        hours_to_show: 48
        refresh_interval: 60
        entities:
          - entity: sensor.procon_ip_pool_controller_durchfluss
            name: Flow (L/h)
          - entity: sensor.procon_ip_pool_controller_kesseldruck
            name: Pressure (bar)

      - type: history-graph
        title: Canister Fill Levels (30 days)
        hours_to_show: 720
        refresh_interval: 3600
        entities:
          - entity: sensor.procon_ip_pool_controller_cl_rest
            name: Chlorine %
          - entity: sensor.procon_ip_pool_controller_ph_rest
            name: pH− %


  ##########################################################################
  #  VIEW 3 – RELAY CONTROL
  ##########################################################################
  - title: Controls
    path: pool-controls
    icon: mdi:toggle-switch
    cards:

      - type: markdown
        content: >
          ## Relay Control

          Each relay supports three modes:
          **auto** – ProCon.IP schedule controls this relay |
          **on** – force permanently on |
          **off** – force permanently off

          Add your active relay entities below.
          Find them in **Settings → Devices & Services → ProCon.IP Pool Controller**.

      - type: entities
        title: Relays
        icon: mdi:electric-switch
        entities:
          - entity: select.procon_ip_pool_controller_filterpumpe_n1
            name: Filter Pump (N1)
            icon: mdi:pump
